{% set cols = 5 %}
{% if problems|length > 25 %}
    {% set cols = 6 %}
{% endif %}
{% if problems|length > 30 %}
    {% set cols = 7 %}
{% endif %}
{% if problems|length > 35 %}
    {% set cols = 8 %}
{% endif %}

<style>
.problem-grid {
    display: grid;
    grid-template-columns: repeat(var(--cols, 5), 1fr);
    gap: var(--gap, 2rem);
    padding: 0;
    margin: 0 auto;
    max-width: 8.5in;
}

.problem {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: var(--problem-font-size, 14pt);
    line-height: 1.5;
    padding: 0.5rem;
}

.addition-line {
    border-bottom: 1px solid black;
    width: 100%;
    margin: 0.25rem 0;
}

.answer-space {
    height: 1.5rem;
    width: 100%;
}

.number {
    text-align: right;
    width: 100%;
    font-family: 'Times New Roman', serif;
}

.operator {
    position: absolute;
    left: -0.75rem;
}

.problem-content {
    position: relative;
    width: 3.5rem;
}

/* Division problem specific styles */
.division-problem {
    display: flex;
    align-items: center;
}

.division-symbol {
    display: flex;
    align-items: center;
}

.division-symbol .divisor {
    margin-right: 0.25rem;
}

.division-symbol .right-paren {
    font-size: 1.5em;
    line-height: 1;
}

.division-symbol .dividend {
    margin-left: 0.25rem;
}

@media print {
    @page {
        margin: 0.4in;
    }
}

@media screen {
    .answer-space {
        background-color: #f8f8f8;
    }
}
</style>

<script>
    // Dynamically adjust layout based on problem count
    const problemCount = {{ problems|length }};
    const root = document.documentElement;
    
    // Set columns based on problem count
    let cols = 5;
    if (problemCount > 25) cols = 6;
    if (problemCount > 30) cols = 7;
    if (problemCount > 35) cols = 8;
    root.style.setProperty('--cols', cols);
    
    // Set gap
    const gap = 3.0 - (problemCount / 20);
    root.style.setProperty('--gap', `${gap}rem`);
    
    // Set font size
    const fontSize = 16 - (problemCount / 10);
    root.style.setProperty('--problem-font-size', `${fontSize}pt`);
</script>

<div class="problem-grid">
    {% for problem in problems %}
    <div class="problem">
        <div class="problem-content">
            {% set parts = problem.text.replace(' ', '').replace('×', '*').replace('÷', '/') %}
            {% if '+' in parts %}
                {% set numbers = parts.split('+') %}
                <div class="number">{{ numbers[0] }}</div>
                <div class="number"><span class="operator">+</span>{{ numbers[1] }}</div>
                <div class="addition-line"></div>
                <div class="answer-space"></div>
            {% elif '-' in parts %}
                {% set numbers = parts.split('-') %}
                <div class="number">{{ numbers[0] }}</div>
                <div class="number"><span class="operator">−</span>{{ numbers[1] }}</div>
                <div class="addition-line"></div>
                <div class="answer-space"></div>
            {% elif '*' in parts %}
                {% set numbers = parts.split('*') %}
                <div class="number">{{ numbers[0] }}</div>
                <div class="number"><span class="operator">×</span>{{ numbers[1] }}</div>
                <div class="addition-line"></div>
                <div class="answer-space"></div>
            {% elif '/' in parts %}
                {% set numbers = parts.split('/') %}
                <div class="division-problem">
                    <div class="division-symbol">
                        <span class="divisor">{{ numbers[1] }}</span>
                        <span class="right-paren">)</span>
                        <span class="dividend">{{ numbers[0] }}</span>
                    </div>
                </div>
                <div class="answer-space"></div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div> 